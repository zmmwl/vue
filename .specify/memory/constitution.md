<!--
同步影响报告
==================
版本变更: 1.1.0 -> 1.2.0
修改的原则: 无
新增章节: 项目定位
新增原则: VII. 隐私计算任务编排规范
移除章节: 无
移除原则: 无
需要更新的模板:
  - ✅ plan-template.md - 已审查，Constitution Check 部分已对齐
  - ✅ spec-template.md - 已审查，需求结构已对齐
  - ✅ tasks-template.md - 已审查，任务组织已对齐
后续待办事项: 无
-->

# 隐私计算 DAG 可视化编辑器项目宪章

## 项目定位

本项目为隐私计算用户提供可视化构建隐私计算任务图的能力。通过对数据库表、不同隐私计算技术路径任务进行可视化拖拽、连接、编排，快速构建满足业务需求的 DAG 计算任务图。

## 核心原则

### I. 组件优先架构

所有功能必须作为可复用的 Vue 组件实现，具有以下特征：

- 组件必须具有适当的独立状态
- 组件必须通过 props 接收所有外部依赖
- 组件必须通过事件向父组件通信
- 组件必须可通过单元测试独立测试
- 每个组件必须具有清晰、单一的责任

**理由**: Vue 的组件模型专为可复用性和可测试性而优化。这确保了 DAG 编辑器在复杂性增长时的可维护性。

### II. TypeScript 严格模式

所有代码必须使用 TypeScript 并启用严格类型检查：

- 不允许隐式 any 类型
- 所有函数参数必须声明类型
- 所有返回类型必须显式声明
- Props 必须使用 Vue 的 `PropType` 或 `defineProps<T>()` 定义
- 复杂类型必须导出到 `/src/types/` 目录

**理由**: 隐私计算 DAG 编辑器处理复杂的图结构和关系。TypeScript 的类型系统可防止运行时错误并为重构提供出色的 IDE 支持。

### III. 响应式优先于手动状态

状态管理必须遵循以下规则：

- 使用 Pinia stores 管理跨组件状态
- 使用 Vue 的 `ref` 和 `reactive` 管理组件本地状态
- 避免手动 DOM 操作
- 避免直接修改响应式对象的属性（使用正确的 Vue 方法）

**理由**: Vue 的响应式系统是其性能和简洁性的基础。绕过它会导致错误和维护问题。

### IV. 视觉验证（不可协商）

任何视觉或交互更改必须经过验证：

- 实现之前：创建简单的测试或手动验证计划
- 实现功能
- 验证视觉结果是否符合预期
- 在组件注释中记录边缘情况

**理由**: DAG 编辑器本质上是可视化的。仅靠测试无法验证正确的渲染和交互。

### V. 图数据完整性

图结构必须保持以下不变量：

- 所有节点必须具有唯一 ID
- 所有边必须引用现有的节点 ID
- 必须检测并优雅处理循环依赖
- 图操作必须是原子的或提供回滚能力

**理由**: 破坏的图状态会导致编辑器无法使用。这些不变量防止数据损坏。

### VI. 中文优先文档规范

所有项目文档和注释必须遵循以下规则：

- 项目文档（README、设计文档、API 文档等）必须使用中文编写
- 代码注释优先使用中文，涉及专业术语时保留英文
- 变量和函数命名仍使用英文（遵循编程惯例）
- Git 提交信息使用中文描述
- 代码审查意见使用中文

**理由**: 确保团队成员（包括中文母语者）能够无障碍地理解项目文档和代码意图，降低沟通成本，提高协作效率。

### VII. 隐私计算任务编排规范

隐私计算任务图的编排必须遵循以下规则：

- 任务节点必须明确标注所使用的隐私计算技术（如联邦学习、安全多方计算、差分隐私等）
- 数据源节点必须准确反映数据库表结构和字段信息
- 任务间的依赖关系必须通过有向边明确表示
- 支持任务参数的动态配置和验证
- 必须提供任务执行状态的实时可视化反馈

**理由**: 隐私计算任务涉及多种技术路径和复杂的数据依赖关系，明确的技术标注和依赖管理可确保计算流程的正确性和可追溯性。

## 技术标准

### 语言和框架

- **语言**: TypeScript 5.9+
- **框架**: Vue 3 组合式 API（`<script setup>`）
- **构建工具**: Vite
- **图库**: Vue Flow（核心、背景、控件、小地图）
- **状态管理**: Pinia

### 代码组织

```
src/
├── components/      # 可复用的 Vue 组件
│   ├── nodes/       # 节点组件（数据源、隐私计算任务等）
│   ├── edges/       # 连线组件
│   └── panels/     # 工具面板（属性配置、任务列表等）
├── stores/          # Pinia stores（图状态、任务编排等）
├── types/           # TypeScript 类型定义
│   ├── nodes.ts     # 节点类型定义
│   └── graph.ts     # 图结构类型定义
├── utils/           # 纯工具函数
│   ├── graph.ts      # 图操作工具
│   └── validation.ts # 任务验证逻辑
├── assets/          # 静态资源
└── main.ts          # 应用入口点
```

### 命名约定

- **组件**: PascalCase（例如 `DagEditor.vue`、`DataNode.vue`、`PrivacyTaskNode.vue`）
- **文件**: kebab-case（例如 `dag-editor.ts`、`graph-utils.ts`）
- **类型**: PascalCase，接口使用 `I` 前缀（例如 `INode`、`IEdge`、`IPrivacyTask`）
- **常量**: UPPER_SNAKE_CASE（例如 `MAX_NODES`、`TASK_TYPES`）
- **Store**: camelCase，带 `Store` 后缀（例如 `useGraphStore`、`useTaskStore`）

### 性能要求

- 渲染必须支持 100+ 个节点而不掉帧
- 图操作必须在 16ms 内完成（60fps 目标）
- 典型图的初始加载时间必须低于 2 秒

## 开发工作流

### 代码审查要求

所有拉取请求必须：

- 有清晰的更改描述
- 通过 TypeScript 编译无错误
- 通过所有现有测试
- 至少由另一名开发者审查
- 引用相关问题或规格说明

### 测试策略

- **单元测试**: 用于纯工具函数和业务逻辑（图验证、任务编排算法等）
- **组件测试**: 用于组件行为和 props/事件（节点拖拽、连线交互等）
- **视觉测试**: 手动验证渲染效果（节点样式、连线路径、面板交互等）
- **集成测试**: 用于图操作和用户流程（完整任务编排流程）

### Git 工作流

- 功能分支: `feature/###-name`
- 修复分支: `fix/###-description`
- 使用约定式提交: `feat:`、`fix:`、`refactor:`、`docs:`、`style:`、`test:`、`chore:`

## 治理

### 修订程序

宪章修订遵循以下流程：

1. 提出更改并附上清晰的理由
2. 使用语义化版本号更新版本：
   - MAJOR: 删除或重新定义核心原则
   - MINOR: 新增原则或章节
   - PATCH: 澄清、文字修正
3. 由项目维护者审查和批准
4. 更新所有相关模板以保持一致性
5. 向团队沟通更改

### 版本管理

当前版本: `1.2.0`

版本格式: `MAJOR.MINOR.PATCH`

### 合规审查

- 代码审查期间检查宪章合规性
- 违规必须附带技术理由说明
- 持续违规应触发宪章修订

---

**版本**: 1.2.0 | **批准日期**: 2026-01-15 | **最后修订**: 2026-01-15
